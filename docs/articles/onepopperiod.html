<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with a single population and transition • raretrans</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with a single population and transition">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">raretrans</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/onepopperiod.html">Working with a single population and transition</a>
    </li>
    <li>
      <a href="../articles/transition_priors.html">Effect of prior information on transition probabilities and fertilities</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atyre2/raretrans">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with a single population and transition</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atyre2/raretrans/blob/master/vignettes/onepopperiod.Rmd"><code>vignettes/onepopperiod.Rmd</code></a></small>
      <div class="hidden name"><code>onepopperiod.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">echo =</span> <span class="ot">TRUE</span>, <span class="dt">tidy =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(popbio) <span class="co"># for projection.matrix()</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(raretrans)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># Raymond's theme modifications</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">rlt_theme &lt;-<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>,<span class="dt">face=</span><span class="st">"bold"</span>),</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>, <span class="dt">face=</span><span class="st">"bold"</span>),</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>,<span class="dt">face=</span><span class="st">"bold"</span>),  </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">        <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">"grey20"</span>,<span class="dt">size=</span><span class="dv">15</span>,<span class="dt">face=</span><span class="st">"bold"</span>))</a></code></pre></div>
<p>The goal of this vignette is to demonstrate the use of package <code>raretrans</code> on a single population and transition period.</p>
<div id="part-i-obtaining-the-projection-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#part-i-obtaining-the-projection-matrix" class="anchor"></a>Part I: Obtaining the projection matrix</h1>
<p><code>raretrans</code> assumes the projection matrix is a list of two matrices, a transition matrix and a fertility matrix. This is the output format of <code><a href="https://www.rdocumentation.org/packages/popbio/topics/projection.matrix">popbio::projection.matrix</a></code>. If we have individual transitions in a dataframe we can use <code><a href="https://www.rdocumentation.org/packages/popbio/topics/projection.matrix">popbio::projection.matrix</a></code> to obtain the required data. We demonstrate with the transition and fertility data for the epiphytic orchid <em>Lepanthes elto</em> <strong>POPNUM 250</strong> in <strong>period 5</strong>.</p>
<div id="step-1-load-and-munge-the-single-population-data-for-l--elto" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-load-and-munge-the-single-population-data-for-l--elto" class="anchor"></a>Step 1: Load and munge the single population data for <em>L. elto</em>
</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"L_elto"</span>)  <span class="co"># load the dataset `L_elto` into memory (from package `raretrans`)</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(L_elto)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##   POPNUM  year seedlings adults fertility IND_NUM stage next_stage
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     
## 1    209     1         1      6         0      67 j     j         
## 2    209     1         1      6         0      68 a     a         
## 3    209     1         1      6         0      69 a     a         
## 4    209     1         1      6         0      70 a     a         
## 5    209     1         1      6         0      71 j     a         
## 6    209     1         1      6         0      72 a     a         
## # … with 5 more variables: first_year &lt;dbl&gt;, last_year &lt;dbl&gt;,
## #   recruited &lt;lgl&gt;, died &lt;dbl&gt;, lifespan &lt;int&gt;</code></pre>
<p>Each row of this dataframe has columns for current stage, the next stage, and average per individual fertility. Note that “p” stands from “plantula” which means “seedlings” in Spanish. The first set of lines below change the name of the life history stage from “p” to “s” after selecting the population and time period.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">onepop &lt;-<span class="st"> </span>L_elto <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Filter out population # 250, period (year) 5</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(POPNUM <span class="op">==</span><span class="st"> </span><span class="dv">250</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># redefine p for el plantón to s for seedling</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">mutate</span>(<span class="dt">stage =</span> <span class="kw">case_when</span>(stage <span class="op">==</span><span class="st"> "p"</span> <span class="op">~</span><span class="st"> "s"</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>stage), <span class="dt">next_stage =</span> <span class="kw">case_when</span>(next_stage <span class="op">==</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">    "p"</span> <span class="op">~</span><span class="st"> "s"</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>next_stage))</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co"># popbio::projection.matrix doesn't like tibbles set TF = TRUE to get the</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># right format.</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">TF &lt;-<span class="st"> </span>popbio<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/popbio/topics/projection.matrix">projection.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(onepop), <span class="dt">stage =</span> stage, <span class="dt">fate =</span> next_stage, </a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    <span class="dt">fertility =</span> <span class="st">"fertility"</span>, <span class="dt">sort =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"s"</span>, <span class="st">"j"</span>, <span class="st">"a"</span>), <span class="dt">TF =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">TF  <span class="co"># This is the stage-structured population model</span></a></code></pre></div>
<pre><code>## $T
##    
##              s          j          a
##   s 0.09090909 0.00000000 0.00000000
##   j 0.63636364 0.57446809 0.00000000
##   a 0.00000000 0.29787234 0.85294118
## 
## $F
##    
##             s         j         a
##   s 0.0000000 0.0000000 0.1176471
##   j 0.0000000 0.0000000 0.0000000
##   a 0.0000000 0.0000000 0.0000000</code></pre>
<p>Our stages are now coded as <strong>s</strong> (seedling), <strong>j</strong> (juvenile), and <strong>a</strong> (adult), and we now have two matrices: <strong>T</strong> (stage transition) and <strong>F</strong> (fecundity). The observed asymptotic population growth rate is <span class="math inline">\(\lambda =\)</span> 0.93. The rare transitions missing from our first transition matrix, <code>TF$T</code>, are the transition from seedling (<em>s</em>) to adult (<em>a</em>), and the transition from <em>j</em> to <em>s</em>. But we know that these happen.</p>
</div>
<div id="step-2-obtain-starting-number-of-individuals-per-stage" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-obtain-starting-number-of-individuals-per-stage" class="anchor"></a>Step 2: Obtain starting number of individuals per stage</h2>
<p>Since our priors are based on counts (number of individuals, <em>N</em>) and the prior equivalent sampling size is expressed as a multiple of the number of individuals observed, we need to obtain the number of individuals in each stage (<span class="math inline">\(N\)</span>) at the first time period.</p>
<p>We use function <code><a href="../reference/get_state_vector.html">raretrans::get_state_vector()</a></code> to obtain the starting individual count, <em>N</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">N &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_state_vector.html">get_state_vector</a></span>(onepop, <span class="dt">stage =</span> stage, <span class="dt">sort =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"s"</span>, <span class="st">"j"</span>, <span class="st">"a"</span>))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">N  <span class="co"># A vector of # of starting individuals for each stage</span></a></code></pre></div>
<pre><code>## [1] 11 47 34</code></pre>
<p>The list of matrices and vector of individual counts do not have to come from a dataframe as we’ve done here. As long as they have the expected format they can be created by hand. We use population 231 in period 2 as an example, splitting the matrix into transition T and fecundity F matrices. Below, “m” stands for “muerte” that is plants that are dead.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">TF2</a></code></pre></div>
<pre><code>## $Tmat
##     stage
## fate         p         j         a
##    p 0.5000000 0.0000000 0.0000000
##    j 0.0000000 0.8333333 0.0000000
##    a 0.0000000 0.0625000 0.8750000
## 
## $Fmat
##      [,1] [,2]  [,3]
## [1,]    0    0 0.125
## [2,]    0    0 0.000
## [3,]    0    0 0.000</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">N2</a></code></pre></div>
<pre><code>##  p  j  a 
##  2  6 16</code></pre>
<p>This matrix is missing the transition from seedling to juvenile, and none of the 6 juveniles died leading to an overestimate of survival. The observed asymptotic population growth rate is <span class="math inline">\(\lambda =\)</span> 0.88. The matrix is not Ergodic (you can’t get to every other state from one or more states), and reducible, meaning one or more columns and rows can be discarded and have the same eigen properties.</p>
</div>
</div>
<div id="part-2-using-priors-to-incorporate-rare-transitions" class="section level1">
<h1 class="hasAnchor">
<a href="#part-2-using-priors-to-incorporate-rare-transitions" class="anchor"></a>Part 2: Using priors to incorporate rare transitions</h1>
<div id="use-uninformative-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#use-uninformative-priors" class="anchor"></a>Use uninformative priors</h2>
<p>Tremblay et al (in prep) show that a dirichlet prior works on the columns of the transition matrix (<strong>T</strong>), and a gamma prior works for entries in the fecundity matrix <strong>F</strong>.</p>
<div id="transition-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#transition-matrix" class="anchor"></a>Transition matrix</h3>
<p>So, let’s add a uniform dirichlet prior with weight = <span class="math inline">\(1\)</span> to the transition matrix, <span class="math inline">\(T\)</span>. Here, we have 4 fates (3 + death), so each fate adds 0.25 to the matrix of <em>observed</em> fates (not the transition matrix!). When we specify a prior matrix for the transitions, there is one more row than columns. This extra row represents death.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">Tprior &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="fl">0.25</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">nrow =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> Tprior)  <span class="co"># returns transition matrix by default</span></a></code></pre></div>
<pre><code>##            [,1]        [,2]        [,3]
## [1,] 0.10416667 0.005208333 0.007142857
## [2,] 0.60416667 0.567708333 0.007142857
## [3,] 0.02083333 0.296875000 0.835714286</code></pre>
<p>We can get the same result ‘by hand’ - we need the vector of observations because the posterior is calculated from the observed transitions, not the transition matrix.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">Tobs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sweep">sweep</a></span>(TF<span class="op">$</span>T, <span class="dv">2</span>, N, <span class="st">"*"</span>)  <span class="co"># get the observed transitions</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">Tobs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(Tobs, N <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(Tobs))  <span class="co"># add the mortality row</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">Tobs &lt;-<span class="st"> </span>Tobs <span class="op">+</span><span class="st"> </span><span class="fl">0.25</span>  <span class="co"># add the prior</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sweep">sweep</a></span>(Tobs, <span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(Tobs), <span class="st">"/"</span>)[<span class="op">-</span><span class="dv">4</span>, ]  <span class="co"># divide by the column sum, and discard mortalityrow</span></a></code></pre></div>
<pre><code>##            s           j           a
## s 0.10416667 0.005208333 0.007142857
## j 0.60416667 0.567708333 0.007142857
## a 0.02083333 0.296875000 0.835714286</code></pre>
<p>The uniform prior fills in the missing transitions, but also creates problems because it provides transition values that are biologically impossible. For example, it provides a transition for adult-&gt;seedling, when this transition is only possible in the fecundity matrix <span class="math inline">\(F\)</span>. For this reason we do not recommend using uniform priors.</p>
</div>
<div id="fertility-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#fertility-matrix" class="anchor"></a>Fertility matrix</h3>
<p>We must specify the parameters for the fertility prior as a matrix. Entries representing stages that are non-reproducing or outcome stages that don’t occur by reproduction should be <code>NA</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">alpha &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">    <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">beta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, </a>
<a class="sourceLine" id="cb16-4" data-line-number="4">    <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw"><a href="../reference/fill_fertility.html">fill_fertility</a></span>(TF, N, <span class="dt">alpha =</span> alpha, <span class="dt">beta =</span> beta)</a></code></pre></div>
<pre><code>##    
##             s         j         a
##   s 0.0000000 0.0000000 0.1176473
##   j 0.0000000 0.0000000 0.0000000
##   a 0.0000000 0.0000000 0.0000000</code></pre>
<p>The change in the fertility is &lt; 0.0001 compared to the observed value. Calculating by hand, prior alpha is the number of observed offspring, and prior beta is the number of observed adults.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">obs_offspring &lt;-<span class="st"> </span>N[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>TF<span class="op">$</span>F[<span class="dv">1</span>, <span class="dv">3</span>]</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">prior_alpha &lt;-<span class="st"> </span><span class="fl">1e-05</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">prior_beta &lt;-<span class="st"> </span><span class="fl">1e-05</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">posterior_alpha &lt;-<span class="st"> </span>obs_offspring <span class="op">+</span><span class="st"> </span>prior_alpha</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">posterior_beta &lt;-<span class="st"> </span>N[<span class="dv">3</span>] <span class="op">+</span><span class="st"> </span>prior_beta</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">posterior_alpha<span class="op">/</span>posterior_beta  <span class="co"># expected value</span></a></code></pre></div>
<pre><code>## [1] 0.1176473</code></pre>
<p>This demonstrates why the posterior point estimate of fecundity does not change much; the non-informative values for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> barely change the observed values.</p>
<p>Now we can put them together.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">unif &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">T =</span> <span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N), <span class="dt">F =</span> <span class="kw"><a href="../reference/fill_fertility.html">fill_fertility</a></span>(TF, N, <span class="dt">alpha =</span> alpha, </a>
<a class="sourceLine" id="cb20-2" data-line-number="2">    <span class="dt">beta =</span> beta))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">unif</a></code></pre></div>
<pre><code>## $T
##            [,1]        [,2]        [,3]
## [1,] 0.10416667 0.005208333 0.007142857
## [2,] 0.60416667 0.567708333 0.007142857
## [3,] 0.02083333 0.296875000 0.835714286
## 
## $F
##    
##             s         j         a
##   s 0.0000000 0.0000000 0.1176473
##   j 0.0000000 0.0000000 0.0000000
##   a 0.0000000 0.0000000 0.0000000</code></pre>
<p>The asymptotic population growth rate is now <span class="math inline">\(\lambda =\)</span> 0.92. The growth rate shrinks slightly because applying the uniform prior to the transition probabilities causes the observed growth and survival transitions to shrink slightly relative to the unobserved transitions.</p>
</div>
<div id="other-options-for-argument-returntype" class="section level3">
<h3 class="hasAnchor">
<a href="#other-options-for-argument-returntype" class="anchor"></a>Other options for argument <code>returnType</code>
</h3>
<p>By default <code><a href="../reference/fill_transitions.html">fill_transitions()</a></code> returns the transition matrix <span class="math inline">\(T\)</span>, and <code><a href="../reference/fill_fertility.html">fill_fertility()</a></code> returns the fertility matrix <span class="math inline">\(F\)</span>. There are three other values that the argument <code>returnType</code> can take:</p>
<ol style="list-style-type: decimal">
<li>
<code>fill_transitions(... returnType = "TN")</code> can return an augmented matrix of fates, which is useful for simulation. The fourth row of this result (see below) is the mortality state.</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">returnType =</span> <span class="st">"TN"</span>)</a></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]
## [1,] 1.25  0.25  0.25
## [2,] 7.25 27.25  0.25
## [3,] 0.25 14.25 29.25
## [4,] 3.25  6.25  5.25</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>
<code>fill_fertility(... returnType = "ab")</code> returns the alpha and beta vectors of the posterior.</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="../reference/fill_fertility.html">fill_fertility</a></span>(TF, N, <span class="dt">alpha =</span> alpha, <span class="dt">beta =</span> beta, <span class="dt">returnType =</span> <span class="st">"ab"</span>)</a></code></pre></div>
<pre><code>## $alpha
##    
##     s j       a
##   s     4.00001
##   j            
##   a            
## 
## $beta
##      [,1] [,2]     [,3]
## [1,]   NA   NA 34.00001
## [2,]   NA   NA       NA
## [3,]   NA   NA       NA</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Both functions can also return the full matrix, the sum of <span class="math inline">\(T\)</span> and <span class="math inline">\(F\)</span>.</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">returnType =</span> <span class="st">"A"</span>)</a></code></pre></div>
<pre><code>##    
##               s           j           a
##   s 0.104166667 0.005208333 0.124789916
##   j 0.604166667 0.567708333 0.007142857
##   a 0.020833333 0.296875000 0.835714286</code></pre>
</div>
</div>
<div id="incorporate-informative-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#incorporate-informative-priors" class="anchor"></a>Incorporate informative priors</h2>
<p>To fix the problem of creating impossible transitions, we specify a more informative prior elicited from an expert on epiphytic orchids (RLT). It still has to have the same shape, one more row than columns.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">RLT_Tprior &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.025</span>, <span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.9</span>, <span class="fl">0.025</span>, <span class="fl">0.01</span>, <span class="fl">0.025</span>, <span class="fl">0.95</span>, </a>
<a class="sourceLine" id="cb28-2" data-line-number="2">    <span class="fl">0.69</span>, <span class="fl">0.05</span>, <span class="fl">0.025</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>Note that the 1st row, 3rd column is 0.0, because this transition is impossible. This prior is constructed so the columns sum to 1, which creates the greatest flexibility for weighting the prior. By default the weight is 1, interpreted as a prior sample size of 1.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior)</a></code></pre></div>
<pre><code>##              [,1]         [,2]         [,3]
## [1,] 0.1041666667 0.0005208333 0.0000000000
## [2,] 0.5875000000 0.5812500000 0.0007142857
## [3,] 0.0008333333 0.2921875000 0.8557142857</code></pre>
<p>We can specify the weight as a multiple of the sample size for each stage.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">priorweight =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>##             [,1]        [,2]        [,3]
## [1,] 0.143939394 0.008333333 0.000000000
## [2,] 0.440909091 0.682978723 0.008333333
## [3,] 0.003333333 0.206914894 0.885294118</code></pre>
<p>Here the prior is weighted half as much as the observed number of transitions. In this case, with only 2 transitions the prior effective sample size is still 1. If the number of observed transitions was larger, a prior weight of 0.5N would be larger than 1, but still allow the data to dominate.</p>
</div>
</div>
<div id="part-3-obtain-credible-intervals" class="section level1">
<h1 class="hasAnchor">
<a href="#part-3-obtain-credible-intervals" class="anchor"></a>Part 3: Obtain Credible Intervals</h1>
<div id="obtain-ci-for-indvidual-matrix-entries" class="section level2">
<h2 class="hasAnchor">
<a href="#obtain-ci-for-indvidual-matrix-entries" class="anchor"></a>Obtain CI for indvidual matrix entries</h2>
<p>The marginal posterior distribution of one element in a multinomial is a beta distribution, and we use this to get credible intervals on our transition rates. We can use the TN return type to get the parameters of the desired multinomial.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">TN &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">priorweight =</span> <span class="fl">0.5</span>, <span class="dt">returnType =</span> <span class="st">"TN"</span>)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">a &lt;-<span class="st"> </span>TN[, <span class="dv">1</span>]  <span class="co"># change 1 to 2, 3 etc to get marginal distribution of other columns</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3">b &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(TN[, <span class="dv">1</span>]) <span class="op">-</span><span class="st"> </span>TN[, <span class="dv">1</span>]  <span class="co"># change 1 to 2, 3 etc to get marginal distribution of other columns</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4">p &lt;-<span class="st"> </span>a<span class="op">/</span>(a <span class="op">+</span><span class="st"> </span>b)</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">lcl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Beta">qbeta</a></span>(<span class="fl">0.025</span>, a, b)</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">ucl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Beta">qbeta</a></span>(<span class="fl">0.975</span>, a, b)</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"%.3f (%.3f, %.3f)"</span>, p, lcl, ucl))</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0.144 (0.025, 0.343)</td>
</tr>
<tr class="even">
<td align="left">0.441 (0.218, 0.677)</td>
</tr>
<tr class="odd">
<td align="left">0.003 (0.000, 0.038)</td>
</tr>
<tr class="even">
<td align="left">0.412 (0.195, 0.649)</td>
</tr>
</tbody>
</table>
<p>Those are the point estimates (compare with first column above), lower and upper <span class="math inline">\(95\%\)</span> symmetric credible intervals for transitions out of the seedling stage. There is a high degree of uncertainty because of the small sample size (<span class="math inline">\(2\)</span>), and low weight on the prior (<span class="math inline">\(1\)</span>), leading to an effective sample size of 3. If we increase the effective sample size to <span class="math inline">\(20\)</span> by specifying: <code>priorweight</code><span class="math inline">\(= 9 (9*2 = 18 + 2 = 20)\)</span> the symmetric credible intervals shrink quite a bit:</p>
<p><img src="onepopperiod_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>The transition rate from seedling to juvenile shrinks when the prior sample size is too large. In general the prior sample size should be less than the observed sample size.</p>
</div>
<div id="credible-intervals-on-lambda" class="section level2">
<h2 class="hasAnchor">
<a href="#credible-intervals-on-lambda" class="anchor"></a>Credible intervals on <span class="math inline">\(\lambda\)</span>
</h2>
<p>Obtaining credible intervals on the asymptotic growth rate, <span class="math inline">\(\lambda\)</span>, requires simulating matrices from the posterior distributions. This is somewhat complicated to do correctly, and we have written a function <code><a href="../reference/sim_transitions.html">raretrans::sim_transitions()</a></code> to generate a list of simulated matrices given the observed matrix and prior specifications.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="../reference/sim_transitions.html">sim_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">alpha =</span> alpha, <span class="dt">beta =</span> beta, <span class="dt">priorweight =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## [[1]]
##              [,1]       [,2]         [,3]
## [1,] 7.261332e-02 0.01202102 0.0000000000
## [2,] 6.129123e-01 0.64099184 0.0001809654
## [3,] 4.610927e-06 0.24434552 0.9338248029</code></pre>
<p>Now we simulate 1000 times, calculate the leading eigenvalue of each matrix, and draw a histogram.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">8390278</span>)  <span class="co"># make this part reproducible</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2">alpha2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">0.025</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, </a>
<a class="sourceLine" id="cb36-3" data-line-number="3">    <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">beta2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="dv">1</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, </a>
<a class="sourceLine" id="cb36-5" data-line-number="5">    <span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="co"># generate 1000 matrices based on the prior transitions and fertilities plus</span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="co"># the data</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8">RLT_<span class="fl">0.5</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_transitions.html">sim_transitions</a></span>(TF, N, <span class="dt">P =</span> RLT_Tprior, <span class="dt">alpha =</span> alpha2, <span class="dt">beta =</span> beta2, </a>
<a class="sourceLine" id="cb36-9" data-line-number="9">    <span class="dt">priorweight =</span> <span class="fl">0.5</span>, <span class="dt">samples =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="co"># extract the lambdas for each matrix</span></a>
<a class="sourceLine" id="cb36-11" data-line-number="11">RLT_<span class="fl">0.5</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">lposterior =</span> <span class="kw">map_dbl</span>(RLT_<span class="fl">0.5</span>, lambda))</a>
<a class="sourceLine" id="cb36-12" data-line-number="12"></a>
<a class="sourceLine" id="cb36-13" data-line-number="13"><span class="kw">ggplot</span>(<span class="dt">data =</span> RLT_<span class="fl">0.5</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> lposterior)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.02</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb36-14" data-line-number="14"><span class="st">    </span>rlt_theme</a></code></pre></div>
<p><img src="onepopperiod_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>We can calculate some summary statistics too. <code>pincrease</code> is the probability that <span class="math inline">\(\lambda &gt; 1\)</span>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">RLT_<span class="fl">0.5</span>_summary &lt;-<span class="st"> </span><span class="kw">summarize</span>(RLT_<span class="fl">0.5</span>, <span class="dt">medianL =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/median">median</a></span>(lposterior), <span class="dt">meanL =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(lposterior), </a>
<a class="sourceLine" id="cb37-2" data-line-number="2">    <span class="dt">lcl =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(lposterior, <span class="dt">probs =</span> <span class="fl">0.025</span>), <span class="dt">ucl =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(lposterior, <span class="dt">probs =</span> <span class="fl">0.975</span>), </a>
<a class="sourceLine" id="cb37-3" data-line-number="3">    <span class="dt">pincrease =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(lposterior <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="kw">n</span>())</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(RLT_<span class="fl">0.5</span>_summary, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">medianL</th>
<th align="right">meanL</th>
<th align="right">lcl</th>
<th align="right">ucl</th>
<th align="right">pincrease</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.9</td>
<td align="right">0.89</td>
<td align="right">0.81</td>
<td align="right">0.96</td>
<td align="right">0</td>
</tr></tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#part-i-obtaining-the-projection-matrix">Part I: Obtaining the projection matrix</a><ul class="nav nav-pills nav-stacked">
<li><a href="#step-1-load-and-munge-the-single-population-data-for-l--elto">Step 1: Load and munge the single population data for <em>L. elto</em></a></li>
      <li><a href="#step-2-obtain-starting-number-of-individuals-per-stage">Step 2: Obtain starting number of individuals per stage</a></li>
      </ul>
</li>
      <li>
<a href="#part-2-using-priors-to-incorporate-rare-transitions">Part 2: Using priors to incorporate rare transitions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#use-uninformative-priors">Use uninformative priors</a></li>
      <li><a href="#incorporate-informative-priors">Incorporate informative priors</a></li>
      </ul>
</li>
      <li>
<a href="#part-3-obtain-credible-intervals">Part 3: Obtain Credible Intervals</a><ul class="nav nav-pills nav-stacked">
<li><a href="#obtain-ci-for-indvidual-matrix-entries">Obtain CI for indvidual matrix entries</a></li>
      <li><a href="#credible-intervals-on-lambda">Credible intervals on <span class="math inline">\(\lambda\)</span></a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andrew Tyre, Raymond Tremblay, Maria-Eglee Perez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
