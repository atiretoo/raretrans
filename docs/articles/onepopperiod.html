<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with a single population and transition â€¢ raretrans</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">raretrans</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Working with a single population and transition</h1>
            
          </div>

    
    
<div class="contents">
<p>We want to be able to use this package with single populations and transitions. Regardless of how many populations there are, we need the data in the form expected by <code>popbio::projection_matrix</code> to get the matrices we want. Here we demonstrate how the package works with a single population in the desired format, by extracting the transition and fertility data for <em>L. elto</em> POPNUM 250 in period 5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raretrans)
<span class="kw">data</span>(<span class="st">"L_elto"</span>)
onepop &lt;-<span class="st"> </span><span class="kw">filter</span>(L_elto, POPNUM <span class="op">==</span><span class="st"> </span><span class="dv">250</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">stage =</span> <span class="kw">case_when</span>(stage <span class="op">==</span><span class="st"> "p"</span> <span class="op">~</span><span class="st"> "s"</span>,
                           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>stage),
         <span class="dt">next_stage =</span> <span class="kw">case_when</span>(next_stage <span class="op">==</span><span class="st"> "p"</span><span class="op">~</span><span class="st"> "s"</span>,
                                <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>next_stage))
TF &lt;-<span class="st"> </span><span class="kw">projection.matrix</span>(<span class="kw">as.data.frame</span>(onepop), <span class="dt">stage =</span> stage, <span class="dt">fate =</span> next_stage, <span class="dt">fertility=</span><span class="st">"fertility"</span>, <span class="dt">sort=</span><span class="kw">c</span>(<span class="st">"s"</span>,<span class="st">"j"</span>,<span class="st">"a"</span>), <span class="dt">TF =</span> <span class="ot">TRUE</span>)
TF</code></pre></div>
<pre><code>## $T
##    
##              s          j          a
##   s 0.09090909 0.00000000 0.00000000
##   j 0.63636364 0.57446809 0.00000000
##   a 0.00000000 0.29787234 0.85294118
## 
## $F
##    
##             s         j         a
##   s 0.0000000 0.0000000 0.1176471
##   j 0.0000000 0.0000000 0.0000000
##   a 0.0000000 0.0000000 0.0000000</code></pre>
<p>Now we also need the number of individuals in each stage at the start. This is because our priors are based on counts, and the prior equivalent sample size is expressed as a multiple of the number of individuals observed. We have a function <code>raretrans::get_state_vector()</code> to do this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_state_vector.html">get_state_vector</a></span>(<span class="kw">as.data.frame</span>(onepop), <span class="dt">stage =</span> stage, <span class="dt">sort=</span><span class="kw">c</span>(<span class="st">"s"</span>,<span class="st">"j"</span>,<span class="st">"a"</span>))
N</code></pre></div>
<pre><code>## [1] 11 47 34</code></pre>
<p>The rare transition that is missing from this matrix is the seedling to adult, which in the RLT prior happens ~ 1% of the time. The observed asymptotic population growth rate is <span class="math inline">\(\lambda =\)</span> 0.9282277.</p>
<p>First, use the default uniform prior on transitions and uninformative gamma on fecundity. We have to specify the parameters for the fecundity prior on non-reproducing stages as missing, or the result will fill in the entire matrix. The default for both functions returns the full matrix <strong>A</strong>, so we have to tell the function to only return the transition and fecundity matrices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unif &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">T =</span> <span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">returnType =</span> <span class="st">"T"</span>), <span class="dt">F =</span> <span class="kw"><a href="../reference/fill_fecundity.html">fill_fecundity</a></span>(TF, N, 
                                                             <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),
                                                             <span class="dt">beta =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),
                                                             <span class="dt">returnType =</span> <span class="st">"F"</span>))
unif</code></pre></div>
<pre><code>## $T
##            [,1]        [,2]        [,3]
## [1,] 0.10416667 0.005208333 0.007142857
## [2,] 0.60416667 0.567708333 0.007142857
## [3,] 0.02083333 0.296875000 0.835714286
## 
## $F
##      [,1] [,2]      [,3]
## [1,]    0    0 0.1176473
## [2,]    0    0 0.0000000
## [3,]    0    0 0.0000000</code></pre>
<p>And the asymptotic population growth rate is <span class="math inline">\(\lambda =\)</span> 0.9228041. The growth rate shrinks slightly because applying the uniform prior on transition probabilities causes observed growth and survival transitions to shrink slightly relative to those that are unobserved.</p>
<p>There are two other returnTypes. <code><a href="../reference/fill_transitions.html">fill_transitions()</a></code> can return an augmented matrix of fates which is useful for simulation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/fill_transitions.html">fill_transitions</a></span>(TF, N, <span class="dt">returnType =</span> <span class="st">"TN"</span>)</code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]
## [1,] 1.25  0.25  0.25
## [2,] 7.25 27.25  0.25
## [3,] 0.25 14.25 29.25
## [4,] 3.25  6.25  5.25</code></pre>
<p>The fourth row of this result is the mortality state. <code><a href="../reference/fill_fecundity.html">fill_fecundity()</a></code> can return the alpha and beta vectors of the posterior.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/fill_fecundity.html">fill_fecundity</a></span>(TF, N, 
               <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),
               <span class="dt">beta =</span> <span class="kw">c</span>(<span class="ot">NA_real_</span>, <span class="ot">NA_real_</span>, <span class="fl">1e-05</span>),
               <span class="dt">returnType =</span> <span class="st">"ab"</span>)</code></pre></div>
<pre><code>## $alpha
##       s       j       a 
##      NA      NA 4.00001 
## 
## $beta
## [1]       NA       NA 34.00001</code></pre>
<p>This demonstrates why the posterior point estimate does not change much; the non-informative values for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> barely change the observed values.</p>
<p>We can skip using <code>popbio::projection_matrix()</code> if the matrix is already calculated, as long as we also have the stage vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Matrix</span>
Lep_rup &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">T =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.0</span>,   <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="dv">0</span>,
                             <span class="fl">0.0</span>,   <span class="fl">0.515</span>,   <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
                             <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.777</span>, <span class="dv">0</span>, <span class="dv">0</span>,
                             <span class="dv">0</span>, <span class="fl">0.368</span>, <span class="fl">0.011</span>, <span class="fl">0.730</span>, <span class="fl">0.171</span>,
                             <span class="dv">0</span>, <span class="fl">0.037</span>, <span class="dv">0</span>, <span class="fl">0.169</span>, <span class="fl">0.790</span>), 
                           <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">5</span>),
                <span class="co"># Fecundity</span>
                <span class="dt">F =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.0</span>,   <span class="fl">0.0</span>, <span class="fl">0.120</span>, <span class="fl">0.414</span>,
                             <span class="fl">0.0</span>,   <span class="dv">0</span>,   <span class="dv">0</span>, <span class="fl">0.076</span>, <span class="fl">0.013</span>,
                             <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
                             <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
                             <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), 
                           <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">5</span>))
Lep_rup</code></pre></div>
<pre><code>## $T
##      [,1]  [,2]  [,3]  [,4]  [,5]
## [1,]    0 0.000 0.000 0.000 0.000
## [2,]    0 0.515 0.000 0.000 0.000
## [3,]    0 0.000 0.777 0.000 0.000
## [4,]    0 0.368 0.011 0.730 0.171
## [5,]    0 0.037 0.000 0.169 0.790
## 
## $F
##      [,1] [,2] [,3]  [,4]  [,5]
## [1,]    0    0    0 0.120 0.414
## [2,]    0    0    0 0.076 0.013
## [3,]    0    0    0 0.000 0.000
## [4,]    0    0    0 0.000 0.000
## [5,]    0    0    0 0.000 0.000</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Tyre Andrew, Tremblay Raymond, Perez Maria-Eglee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
